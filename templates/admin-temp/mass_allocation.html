{% load static %} {% load custom_filters %}

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Student Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom warm cream colors */
      :root {
        --cream-light: #f5f0e6;
        --cream-base: #e0d7c6;
        --cream-dark: #c8bca1;
        --cream-darker: #a7987a;
      }
    </style>
  </head>
  <body class="bg-[var(--cream-light)] min-h-screen font-sans text-gray-800">
    <div class="max-w-7xl mx-auto p-8">
      <h1 class="text-4xl font-semibold mb-10 text-[var(--cream-darker)]">
        Student Details
      </h1>

      {% if messages %}
      <ul class="mb-6 space-y-2">
        {% for message in messages %}
        <li
          class="p-4 rounded-md {% if message.tags == 'error' %} bg-red-100 text-red-800 border border-red-400 {% elif message.tags == 'success' %} bg-green-100 text-green-800 border border-green-400 {% else %} bg-yellow-100 text-yellow-800 border border-yellow-400 {% endif %}"
        >
          {{ message }}
        </li>
        {% endfor %}
      </ul>
      {% endif %}

      <!-- STUDENT TABLE -->
      <div
        class="overflow-x-auto shadow-md rounded-lg border border-[var(--cream-base)] bg-white mb-12"
      >
        <table
          class="min-w-full border-collapse border border-[var(--cream-base)]"
        >
          <thead
            class="bg-[var(--cream-base)] text-[var(--cream-darker)] uppercase text-sm font-semibold select-none"
          >
            <tr>
              <th class="py-3 px-5 border border-[var(--cream-base)]">ID</th>
              <th class="py-3 px-5 border border-[var(--cream-base)]">Name</th>
              <th class="py-3 px-5 border border-[var(--cream-base)]">Email</th>
              <th class="py-3 px-5 border border-[var(--cream-base)]">Phone</th>
              <th class="py-3 px-5 border border-[var(--cream-base)]">
                Course Opted
              </th>
              <th class="py-3 px-5 border border-[var(--cream-base)]">
                Branch 1
              </th>
              <th class="py-3 px-5 border border-[var(--cream-base)]">
                Branch 2
              </th>
              <th class="py-3 px-5 border border-[var(--cream-base)]">
                Allotted Branch
              </th>
              <th class="py-3 px-5 border border-[var(--cream-base)]">Rank</th>
            </tr>
          </thead>
          <tbody class="text-[var(--cream-darker)]">
            {% for student in students %}
            <tr class="hover:bg-[var(--cream-light)] transition">
              <td
                class="py-2 px-4 border border-[var(--cream-base)] text-center"
              >
                {{ student.id }}
              </td>
              <td class="py-2 px-4 border border-[var(--cream-base)]">
                {{ student.name }}
              </td>
              <td class="py-2 px-4 border border-[var(--cream-base)]">
                {{ student.email }}
              </td>
              <td class="py-2 px-4 border border-[var(--cream-base)]">
                {{ student.phone }}
              </td>
              <td class="py-2 px-4 border border-[var(--cream-base)]">
                {{ student.course_opted }}
              </td>
              <td class="py-2 px-4 border border-[var(--cream-base)]">
                {{ student.branch_1 }}
              </td>
              <td class="py-2 px-4 border border-[var(--cream-base)]">
                {{ student.branch_2 }}
              </td>
              <td class="py-2 px-4 border border-[var(--cream-base)]">
                {{ student.allotted_branch }}
              </td>
              <td
                class="py-2 px-4 border border-[var(--cream-base)] text-center"
              >
                {{ student.rank }}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="9" class="py-4 text-center italic text-gray-500">
                No student records found.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-xl p-8 mt-10">
  <h2 class="text-2xl font-bold mb-6 text-gray-800">Allot Branch by Name / Percentage</h2>

  <form method="POST" action="{% url 'allot_branch' %}" class="space-y-6 bg-gray-50 p-6 rounded-lg border border-gray-200">
    {% csrf_token %}

    <!-- Student Name -->
    <div>
      <label for="student_name" class="block text-sm font-medium text-gray-700 mb-1">Student Name (Optional)</label>
      <input type="text" name="student_name" id="student_name" placeholder="Enter student name" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition">
    </div>

    <!-- Minimum Percentage -->
    <div>
      <label for="min_percentage" class="block text-sm font-medium text-gray-700 mb-1">Minimum Percentage (Optional)</label>
      <input type="number" step="0.01" name="min_percentage" id="min_percentage" placeholder="e.g., 70" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition">
    </div>

    <!-- Maximum Percentage -->
    <div>
      <label for="max_percentage" class="block text-sm font-medium text-gray-700 mb-1">Maximum Percentage (Optional)</label>
      <input type="number" step="0.01" name="max_percentage" id="max_percentage" placeholder="e.g., 100" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition">
    </div>

    <!-- Branch Selection -->
    <div>
      <label for="branch_to_allot" class="block text-sm font-medium text-gray-700 mb-1">Branch to Allot</label>
      <select name="branch_to_allot" id="branch_to_allot" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition">
        <option value="" disabled selected>Select Branch</option>
        <option value="CSE">Computer Science</option>
        <option value="ECE">Electronics</option>
        <option value="ME">Mechanical</option>
      </select>
    </div>

    <!-- Submit Button -->
    <div class="text-right">
      <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded-md shadow hover:bg-indigo-700 transition font-semibold">
        Allot Branch
      </button>
    </div>
  </form>
</div>

      <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-xl p-8 mt-10">
        <h2 class="text-2xl font-bold mb-6 text-gray-800">
          Mass Branch Allocation
        </h2>

        {% if messages %}
        <ul class="mb-4 space-y-2">
          {% for message in messages %}
          <li
            class="p-3 rounded-md text-white {% if message.tags == 'success' %} bg-green-500 {% elif message.tags == 'error' %} bg-red-500 {% else %} bg-yellow-500 {% endif %}"
          >
            {{ message }}
          </li>
          {% endfor %}
        </ul>
        {% endif %}

        <form
          method="POST"
          action="{% url "mass_allocation" %}"
          class="space-y-6 bg-gray-50 p-6 rounded-lg border border-gray-200"
        >
          {% csrf_token %}

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Minimum Percentage -->
            <div>
              <label
                for="min_percentage"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                Minimum Percentage
              </label>
              <input
                type="number"
                name="min_percentage"
                id="min_percentage"
                step="0.01"
                required
                placeholder="e.g., 70"
                class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition"
              />
            </div>

            <!-- Maximum Percentage -->
            <div>
              <label
                for="max_percentage"
                class="block text-sm font-medium text-gray-700 mb-1"
              >
                Maximum Percentage
              </label>
              <input
                type="number"
                name="max_percentage"
                id="max_percentage"
                step="0.01"
                required
                placeholder="e.g., 100"
                class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition"
              />
            </div>
          </div>

          <!-- Branch Selection -->
          <div>
            <label
              for="branch_to_allot"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Branch to Allot
            </label>
            <select
              name="branch_to_allot"
              id="branch_to_allot"
              required
              class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition"
            >
              <option value="" disabled selected>Select Branch</option>
              <option value="CSE">Computer Science</option>
              <option value="ECE">Electronics</option>
              <option value="ME">Mechanical</option>
            </select>
          </div>

          <!-- Submit Button -->
          <div class="text-right">
            <button
              type="submit"
              class="bg-indigo-600 text-white px-6 py-2 rounded-md shadow hover:bg-indigo-700 transition font-semibold"
            >
              Allot Branch
            </button>
          </div>
        </form>
      </div>

      <!-- STUDENT FORM -->
      {% comment %} <div
        class="bg-white shadow-lg rounded-lg p-8 border border-[var(--cream-base)] max-w-5xl mx-auto"
      >
        <h2 class="text-3xl font-semibold mb-6 text-[var(--cream-darker)]">
          Add / Edit Student
        </h2>

        <form method="POST" class="space-y-6">
          {% csrf_token %}
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {% for field in form %}
            <div>
              <label
                for="{{ field.id_for_label }}"
                class="block text-sm font-medium mb-1 text-[var(--cream-darker)]"
              >
                {{ field.label }} </label
              >{{ field|add_class:"w-full border border-[var(--cream-base)]
              rounded-md px-3 py-2 focus:outline-none focus:ring-2
              focus:ring-[var(--cream-dark)] focus:border-[var(--cream-dark)]
              transition" }} {% if field.errors %}
              <p class="text-red-600 text-xs mt-1">{{ field.errors }}</p>
              {% endif %}
            </div>
            {% endfor %}
          </div>

          <button
            type="submit"
            class="mt-6 px-8 py-3 bg-[var(--cream-dark)] text-white rounded-md shadow hover:bg-[var(--cream-darker)] transition font-semibold"
          >
            Save Student
          </button>
        </form>
      </div> {% endcomment %}
    </div>
  </body>
</html>
